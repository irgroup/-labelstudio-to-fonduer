
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="..">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.9">
    
    
      
        <title>Transfer labels to Fonduer - Label Studio to Fonduer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#transfer-labels-to-fonduer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Label Studio to Fonduer" class="md-header__button md-logo" aria-label="Label Studio to Fonduer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8l-9.8 58.8h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8l-9.7 58.8H416c17.7 0 32 14.3 32 32s-14.3 32-32 32h-68.9l-21.3 128H384c17.7 0 32 14.3 32 32s-14.3 32-32 32h-68.9l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7h-95.2l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.7-58.9H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zm5.8 159.6-21.3 128h95.1l21.3-128h-95.1z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Label Studio to Fonduer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Transfer labels to Fonduer
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/irgroup/labelstudio-to-fonduer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    labelstudio-to-fonduer
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Label Studio to Fonduer" class="md-nav__button md-logo" aria-label="Label Studio to Fonduer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8l-9.8 58.8h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8l-9.7 58.8H416c17.7 0 32 14.3 32 32s-14.3 32-32 32h-68.9l-21.3 128H384c17.7 0 32 14.3 32 32s-14.3 32-32 32h-68.9l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7h-95.2l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.7-58.9H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zm5.8 159.6-21.3 128h95.1l21.3-128h-95.1z"/></svg>

    </a>
    Label Studio to Fonduer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/irgroup/labelstudio-to-fonduer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    labelstudio-to-fonduer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introcuction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../example_document_converter/" class="md-nav__link">
        Document Converter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ToFonduer/" class="md-nav__link">
        Transfer labels to Fonduer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ToLabelStudio/" class="md-nav__link">
        Transfer labels to Label Studio
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../document_converter/" class="md-nav__link">
        Document Converter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../to_label_studio/" class="md-nav__link">
        To Label Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../to_fonduer/" class="md-nav__link">
        To Fonduer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fonduer_tools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fonduer-setup" class="md-nav__link">
    Fonduer setup:
  </a>
  
    <nav class="md-nav" aria-label="Fonduer setup:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read-export" class="md-nav__link">
    Read export
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-fonduer-project" class="md-nav__link">
    Create the fonduer project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-html-document-processor" class="md-nav__link">
    Setup HTML document processor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-lingual-parser" class="md-nav__link">
    Setup lingual parser
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-documents" class="md-nav__link">
    Import documents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-fonduer-datamodel" class="md-nav__link">
    Setup Fonduer datamodel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-gold-label" class="md-nav__link">
    Load gold label
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/irgroup/labelstudio-to-fonduer/tree/main/docs/example_to_fonduer.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="transfer-labels-to-fonduer">Transfer labels to Fonduer</h1>
<p>In this example, we will transfer the labels we manually annotated in Label Studio to Fonduer to be used as gold labels for evaluation.</p>
<details class="danger" open="open">
<summary>Danger</summary>
<p>Before any labels are annotated, please ensure that the document representations in Fonduer and Label Studio are the same. Otherwise, the labels might not be transferable! See <a href="../example_document_converter/">example_document_converter</a> for further information.</p>
</details>
<h2 id="fonduer-setup">Fonduer setup:</h2>
<p>The way fonduer is set up might influence the ability to transfer labels between the systems. Therefore, Fonduer has to be configured so that it does not need to modify the documents.</p>
<h3 id="read-export">Read export</h3>
<p>First, we start with reading the export from Label Studio. We can use some of the information from our export to configure our data model in fonduer later.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">LabelstudioToFonduer.to_fonduer</span> <span class="kn">import</span> <span class="n">parse_export</span>

<span class="n">export</span> <span class="o">=</span> <span class="n">parse_export</span><span class="p">(</span><span class="n">label_studio_export_path</span><span class="o">=</span><span class="s2">&quot;data/export.json&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="create-the-fonduer-project">Create the fonduer project</h3>
<p>After that, we create the project in fonduer:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">LabelstudioToFonduer.fonduer_tools</span> <span class="kn">import</span> <span class="n">save_create_project</span>  <span class="c1"># delete old versions of the project</span>
<span class="kn">from</span> <span class="nn">fonduer</span> <span class="kn">import</span> <span class="n">Meta</span><span class="p">,</span> <span class="n">init_logging</span>

<span class="n">conn_string</span> <span class="o">=</span> <span class="s2">&quot;postgresql://postgres:postgres@127.0.0.1:5432/&quot;</span>

<span class="n">save_create_project</span><span class="p">(</span><span class="n">conn_string</span><span class="o">=</span><span class="n">conn_string</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

<span class="n">init_logging</span><span class="p">(</span><span class="n">log_dir</span><span class="o">=</span><span class="s2">&quot;logs&quot;</span><span class="p">))</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">conn_string</span> <span class="o">+</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="setup-html-document-processor">Setup HTML document processor</h3>
<p>Fonduer might read the documents with the wrong encoding, which causes errors. To avoid this, a dedicated <code>HTMLDocPreprocessor</code> can be used. <code>LabelStudio_to_Fonduer</code> provides a slightly modified <code>HTMLDocPreprocessor</code> as a starting point named <a href="https://github.com/irgroup/labelstudio-to-fonduer/blob/main/src/LabelstudioToFonduer/document_processor.py">My_HTMLDocPreprocessor</a>. </p>
<p>The processor can be imported like this:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">LabelstudioToFonduer.document_processor</span> <span class="kn">import</span> <span class="n">My_HTMLDocPreprocessor</span>

<span class="n">doc_preprocessor</span> <span class="o">=</span> <span class="n">My_HTMLDocPreprocessor</span><span class="p">(</span><span class="n">document_path</span><span class="p">,</span> <span class="n">max_docs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="setup-lingual-parser">Setup lingual parser</h3>
<p>By default, Fonduer uses a lingual parser that splits sentences based on the <a href="https://spacy.io/">SpaCy</a> <code>split_sentences</code> function. While this method generally performs quite well, it does not handle abbreviations and special punctuation well.</p>
<p>If our labels contain punctuations or abbreviations, we need to use a modified <code>lingual_parser</code>.
<code>LabelStudio_to_Fonduer</code> comes with a modified version that splits sentences only on the <code>.</code> char and can handle given exceptions. 
To add exceptions and use this <code>ModifiedSpacyParser</code>, we can use this code:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">LabelstudioToFonduer.lingual_parser</span> <span class="kn">import</span> <span class="n">ModifiedSpacyParser</span>

<span class="n">exceptions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.NET&quot;</span><span class="p">,</span> <span class="s2">&quot;Sr.&quot;</span><span class="p">,</span> <span class="s2">&quot;.WEB&quot;</span><span class="p">,</span> <span class="s2">&quot;.de&quot;</span><span class="p">,</span> <span class="s2">&quot;Jr.&quot;</span><span class="p">,</span> <span class="s2">&quot;Inc.&quot;</span><span class="p">,</span> <span class="s2">&quot;Senior.&quot;</span><span class="p">]</span>
<span class="n">my_parser</span> <span class="o">=</span> <span class="n">ModifiedSpacyParser</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">split_exceptions</span><span class="o">=</span><span class="n">exceptions</span><span class="p">)</span>
</code></pre></div>
<h2 id="import-documents">Import documents</h2>
<p>If the pipeline is set up, we can import our documents.
<div class="highlight"><pre><span></span><code><span class="n">corpus_parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span>
    <span class="n">session</span><span class="p">,</span> 
    <span class="n">lingual_parser</span><span class="o">=</span><span class="n">my_parser</span><span class="p">,</span> 
    <span class="n">structural</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">lingual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="p">[])</span>
<span class="n">corpus_parser</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">doc_preprocessor</span><span class="p">,</span> <span class="n">parallelism</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="setup-fonduer-datamodel">Setup Fonduer datamodel</h2>
<p>In this step, the data model is created and then used to create the labeling functions and so on. For further information, please refer to the Fonduer documentation.</p>
<p>As we already have some labeled data, we can derive some starting values to create the Fonduer data model. This configuration is highly dependent on the data we have.</p>
<p>We can get a list of all unique spans from a label in our export:
<div class="highlight"><pre><span></span><code><span class="n">export</span><span class="o">.</span><span class="n">lable_entitis</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p>For example, we can calculate the minimum and maximum ngram size from our export given a label:</p>
<div class="highlight"><pre><span></span><code><span class="n">export</span><span class="o">.</span><span class="n">ngrams</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
</code></pre></div>
<p>It might be beneficial to test the pipeline in advance to make sure Fonduer does not change any document and all annotated spans can be detected. Therefore, we will not spend too much time in setting up labeling functions and only rudimentarily set up some Fonduer processing for now on. After we ensure that the pipeline works for our data, we will come back to that.</p>
<h2 id="load-gold-label">Load gold label</h2>
<p>To use our gold data in fonduer, it is finally time to transfer the labels from Label Studio to Fonduer.</p>
<p>Therefore we create a <code>converter</code> entity from <code>LabelStudioToFonduer</code> based on our parsed export and the fonduer session.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">LabelstudioToFonduer.to_fonduer</span> <span class="kn">import</span> <span class="n">LabelStudioToFonduer</span>

<span class="n">converter</span> <span class="o">=</span> <span class="n">LabelStudioToFonduer</span><span class="p">(</span><span class="n">label_studio_export</span><span class="o">=</span><span class="n">export</span><span class="p">,</span> <span class="n">fonduer_session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</code></pre></div>
<p>Then we use the <code>is_gold</code> function of our converter as a labeling function in the Fonduer Labeler.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fonduer.supervision.models</span> <span class="kn">import</span> <span class="n">GoldLabel</span>
<span class="kn">from</span> <span class="nn">fonduer.supervision</span> <span class="kn">import</span> <span class="n">Labeler</span>

<span class="n">labeler</span> <span class="o">=</span> <span class="n">Labeler</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">[</span><span class="n">TitleDate</span><span class="p">])</span>

<span class="n">labeler</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
    <span class="n">lfs</span><span class="o">=</span><span class="p">[[</span><span class="n">converter</span><span class="o">.</span><span class="n">is_gold</span><span class="p">]],</span>
    <span class="n">table</span><span class="o">=</span><span class="n">GoldLabel</span><span class="p">,</span>
    <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">parallelism</span><span class="o">=</span><span class="n">PARALLEL</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>To check if we were successful, we can count the transferred labels.</p>
<div class="highlight"><pre><span></span><code><span class="n">train_cands</span> <span class="o">=</span> <span class="n">candidate_extractor</span><span class="o">.</span><span class="n">get_candidates</span><span class="p">()</span>
<span class="n">all_gold</span> <span class="o">=</span> <span class="n">labeler</span><span class="o">.</span><span class="n">get_gold_labels</span><span class="p">(</span><span class="n">train_cands</span><span class="p">)</span>

<span class="n">golds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_gold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">train_cands</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">golds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gold labels found:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">golds</span><span class="p">))</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.tracking", "navigation.sections", "navigation.top", "content.code.annotate"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>